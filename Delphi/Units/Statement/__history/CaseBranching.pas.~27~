unit CaseBranching;

interface
uses Base, ConditionalOperator, ArrayList, vcl.graphics, Vcl.ExtCtrls, Types;
type

  TCaseBranching = class(TConditionalOperator)
  private
    FCond: TArrString;
  protected
    procedure CreateBlock; override;
    procedure InitializeBlock; override;
    function GetCondition(const Index: Integer): String; override;
  public
    constructor Create(const AYStart: Integer; const AAction : String;
        const ABaseBlock: TBlock; const AImage: TImage; const ACond: TArrString);
    function IsPreñOperator: Boolean; override;
  end;

implementation

  constructor TCaseBranching.Create(const AYStart: Integer; const AAction : String;
                     const ABaseBlock: TBlock; const AImage: TImage; const ACond: TArrString);
  var
    I: Integer;
  begin
    if Length(ACond) > 1 then
      FCond:= ACond;
  end;

  procedure TCaseBranching.CreateBlock;
  var
    I, BlockSpacing: Integer;
  begin
    SetLength(FBlocks, Length(FCond));

    BlockSpacing:= (BaseBlock.XLast - BaseBlock.XStart) div Length(FBlocks);

    FBlocks[0]:= TBlock.Create(FBaseBlock.XStart,
                       FBaseBlock.XStart + BlockSpacing, Self);

    for I := 1 to High(FBlocks) - 1 do
    begin
      FBlocks[I]:= TBlock.Create(FBlocks[I-1].XStart,
                         FBlocks[I-1].XStart + BlockSpacing, Self);
    end;

    FBlocks[1]:= TBlock.Create(FBlocks[High(FBlocks) - 1].XStart, FBaseBlock.XLast, Self);
  end;

  procedure TCaseBranching.InitializeBlock;
  var
    NewStatement: TStatement;
    I: Integer;
  begin
    for I := 0 to High(FBlocks) - 1 do
    begin
      NewStatement:= DefaultBlock.CreateUncertainty(FBlocks[I], FImage);
      FBlocks[I].AddLast(NewStatement, False);
    end;

    NewStatement:= DefaultBlock.CreateUncertainty(FBlocks[High(FBlocks)], FImage);
    FBlocks[High(FBlocks)].AddLast(NewStatement, True);
  end;

  function TCaseBranching.GetCondition(const Index: Integer): String;
  begin
    if (Index >= 0) and (Index <= High(FCond)) then
      Result := FCond[Index]
    else
      Result := '';
  end;

  function TCaseBranching.IsPreñOperator: Boolean;
  begin
    Result:= True;
  end;

end.
