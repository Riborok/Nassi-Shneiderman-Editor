unit uExport;

interface
uses
  uBase, Vcl.Graphics, Vcl.ExtCtrls, uAdditionalTypes, uConstants;

procedure SaveBMPFile(const ABlock: TBlock; const AFileName: string;
                      const APrevCanvas: TCanvas);
implementation

  procedure SaveBMPFile(const ABlock: TBlock; const AFileName: string;
                        const APrevCanvas: TCanvas);
  var
    VisibleImageRect: TVisibleImageRect;
    Bitmap: TBitmap;
  begin
    Bitmap := TBitmap.Create;
    try
      Bitmap.Width := ABlock.XLast + SchemeIndent;
      Bitmap.Height := ABlock.Statements[ABlock.Statements.Count - 1].GetYBottom + SchemeIndent;

      VisibleImageRect.FTopLeft.X := 0;
      VisibleImageRect.FTopLeft.Y := 0;
      VisibleImageRect.FBottomRight.X := Bitmap.Width;
      VisibleImageRect.FBottomRight.Y := Bitmap.Height;

      ABlock.InstallCanvas(Bitmap.Canvas);
      ABlock.DrawBlock(VisibleImageRect);

      Bitmap.SaveToFile(AFileName);
    finally
      Bitmap.Destroy;
    end;
    ABlock.InstallCanvas(APrevCanvas);
  end;

end.
